<div class="table">
  <div class="table-header">
    <div class="table-title">{{ "Sub Admins" | translate }}</div>
    <div class="table-header-group">
      <div class="table-search">
        <img src="/assets/icons/search-icon.svg" alt="" />
        <input
          type="text"
          [placeholder]="'Search' | translate"
          [(ngModel)]="searchQuery"
        />
      </div>
      <div class="table-add-subadmin" (click)="toggleModal('add')">
        {{ "Add Subadmin" | translate }}
      </div>
    </div>
  </div>

  <!-- Loading indicator -->
  <div *ngIf="isLoading" class="loading">
    {{ "Loading..." | translate }}
  </div>

  <!-- Table content when not loading -->
  <div *ngIf="!isLoading">
    <div class="table-titles">
      <div (click)="sort('firstName')">
        <span>{{ "Name" | translate }}</span>
        <span>
          <img src="/assets/icons/sort-img.svg" />
        </span>
      </div>
      <div (click)="sort('email')">
        <span>{{ "Email" | translate }}</span>
        <span>
          <img src="/assets/icons/sort-img.svg" />
        </span>
      </div>
      <div (click)="sort('status')">
        <span>{{ "Status" | translate }}</span>
        <span>
          <img src="/assets/icons/sort-img.svg" />
        </span>
      </div>
      <div>
        <span>{{ "Actions" | translate }}</span>
      </div>
    </div>

    <div class="table-row" *ngFor="let subAdmin of paginatedSubAdmins">
      <div>{{ subAdmin.firstName }} {{ subAdmin.lastName }}</div>
      <div>{{ subAdmin.email }}</div>
      <div>
        <div [class]="'status-' + subAdmin.status">
          <span>{{ subAdmin.status | titlecase | translate }}</span>
        </div>
      </div>
      <div class="table-actions">
        <span (click)="openDeleteModal(subAdmin)">
          <img src="/assets/icons/delete-admin.svg" alt="delete icon" />
        </span>
        <span (click)="openEditModal(subAdmin)">
          <img src="/assets/icons/edit-admin.svg" alt="edit icon" />
        </span>
      </div>
    </div>

    <!-- Pagination -->
    <div class="table-pagination" *ngIf="!isLoading">
      <!-- Debug: totalPages={{ totalPages }}, totalItems={{ totalItems }}, currentPage={{ currentPage }}, itemsPerPage={{ itemsPerPage }} -->

      <div></div>
      <div class="pagination-controls">
        <button
          class="pagination-btn"
          [disabled]="currentPage === 1"
          (click)="onPageChange(currentPage - 1)"
        >
          {{ "Previous" | translate }}
        </button>

        <div class="page-numbers">
          <button
            *ngFor="let page of getPageNumbers()"
            class="pagination-btn page-number"
            [class.active]="page === currentPage"
            (click)="onPageChange(page)"
          >
            {{ page }}
          </button>
        </div>

        <button
          class="pagination-btn"
          [disabled]="currentPage === totalPages"
          (click)="onPageChange(currentPage + 1)"
        >
          {{ "Next" | translate }}
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Add Subadmin Modal -->
<div class="modal-add-subadmin modal" *ngIf="showAddModal">
  <div class="modal-container">
    <div class="modal-header">
      <div class="modal-title">{{ "Add Sub Admin" | translate }}</div>
      <div class="modal-status">
        <label class="switch">
          <input
            type="checkbox"
            [checked]="selectedSubAdmin.status === 'active'"
            (change)="toggleStatus($event)"
          />
          <span class="slider round"></span>
        </label>
        <span class="status-label">{{
          selectedSubAdmin.status | titlecase | translate
        }}</span>
      </div>
    </div>
    <div class="modal-body">
      <div class="modal-input">
        <label for="firstName">{{ "Firstname" | translate }}</label>
        <input
          type="text"
          id="firstName"
          [placeholder]="'Enter firstname' | translate"
          [(ngModel)]="selectedSubAdmin.firstName"
          required
        />
      </div>
      <div class="modal-input">
        <label for="lastName">{{ "Lastname" | translate }}</label>
        <input
          type="text"
          id="lastName"
          [placeholder]="'Enter lastname' | translate"
          [(ngModel)]="selectedSubAdmin.lastName"
          required
        />
      </div>
      <div class="modal-input">
        <label for="email">{{ "Email" | translate }}</label>
        <input
          type="email"
          id="email"
          [placeholder]="'Enter email' | translate"
          [(ngModel)]="selectedSubAdmin.email"
          required
        />
      </div>
      <div class="modal-input">
        <label for="password">{{ "Password" | translate }}</label>
        <input
          type="password"
          id="password"
          [placeholder]="'Enter password' | translate"
          [(ngModel)]="selectedSubAdmin.password"
          required
        />
      </div>

      <div class="permissions-link" (click)="toggleModal('addPermissions')">
        {{ "Adding permissions" | translate }}
      </div>

      <!-- Validation Errors Section -->
      <div
        *ngIf="validationMessage || getValidationErrorFields().length > 0"
        class="validation-errors"
      >
        <div *ngIf="validationMessage" class="validation-message">
          {{ validationMessage }}
        </div>
        <div
          *ngFor="let field of getValidationErrorFields()"
          class="field-errors"
        >
          <div
            *ngFor="let error of getFieldErrors(field)"
            class="error-message"
          >
            {{ error }}
          </div>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <div class="button-group">
        <button
          class="btn-subadmin-save"
          (click)="saveSubAdmin()"
          [disabled]="!isFormValid() || isLoading"
        >
          <img src="/assets/icons/save-admin.svg" alt="" />
          {{ isLoading ? ("Saving..." | translate) : ("Save" | translate) }}
        </button>
        <button class="btn-subadmin-cancel" (click)="toggleModal('add')">
          <img src="/assets/icons/cancel-admin.svg" alt="" />

          {{ "Cancel" | translate }}
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Edit Subadmin Modal -->
<div class="modal-edit-subadmin modal" *ngIf="showEditModal">
  <div class="modal-container">
    <div class="modal-header">
      <div class="modal-title">{{ "Edit Subadmin" | translate }}</div>
      <div class="modal-status">
        <label class="switch">
          <input
            type="checkbox"
            [checked]="selectedSubAdmin.status === 'active'"
            (change)="toggleStatus($event)"
          />
          <span class="slider round"></span>
        </label>
        <span class="status-label">{{
          selectedSubAdmin.status | titlecase | translate
        }}</span>
      </div>
    </div>
    <div class="modal-body">
      <div class="modal-input">
        <label for="editFirstName">{{ "Firstname" | translate }}</label>
        <input
          type="text"
          id="editFirstName"
          [placeholder]="'Enter firstname' | translate"
          [(ngModel)]="selectedSubAdmin.firstName"
        />
      </div>
      <div class="modal-input">
        <label for="editLastName">{{ "Lastname" | translate }}</label>
        <input
          type="text"
          id="editLastName"
          [placeholder]="'Enter lastname' | translate"
          [(ngModel)]="selectedSubAdmin.lastName"
        />
      </div>
      <div class="modal-input">
        <label for="editEmail">{{ "Email" | translate }}</label>
        <input
          type="text"
          id="editEmail"
          [placeholder]="'Enter email' | translate"
          [(ngModel)]="selectedSubAdmin.email"
        />
      </div>
      <div class="modal-input">
        <label for="editPassword">{{ "Password" | translate }}</label>
        <input
          type="password"
          id="editPassword"
          [placeholder]="'Enter password' | translate"
        />
      </div>
      <div class="permissions-section">
        <h3>{{ "Permissions allowed" | translate }}</h3>
        <div class="permissions-allowed">
          <div *ngFor="let permissionId of selectedSubAdmin.permissions">
            {{ formatPermissionName(getPermissionName(permissionId)) }}
          </div>
          <div *ngIf="selectedSubAdmin.permissions.length === 0">
            {{ "No permissions assigned" | translate }}
          </div>
        </div>
        <div class="permissions-link" (click)="toggleModal('editPermissions')">
          {{ "Edit permissions" | translate }}
        </div>
      </div>

      <!-- Validation Errors Section -->
      <div
        *ngIf="validationMessage || getValidationErrorFields().length > 0"
        class="validation-errors"
      >
        <div *ngIf="validationMessage" class="validation-message">
          {{ validationMessage }}
        </div>
        <div
          *ngFor="let field of getValidationErrorFields()"
          class="field-errors"
          dir="ltr"
        >
          <div
            *ngFor="let error of getFieldErrors(field)"
            class="error-message"
          >
            {{ error }}
          </div>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <div class="button-group">
        <button class="btn-subadmin-save" (click)="saveSubAdmin()">
          <img src="/assets/icons/save-admin.svg" alt="" />

          {{ "Save" | translate }}
        </button>
        <button class="btn-subadmin-cancel" (click)="toggleModal('edit')">
          <img src="/assets/icons/cancel-admin.svg" alt="" />

          {{ "Cancel" | translate }}
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Delete Modal -->
<div class="modal-delete-subadmin modal" *ngIf="showDeleteModal">
  <div class="modal-container">
    <div class="delete-content">
      <img src="/assets/icons/delete-modal.svg" alt="" />
      <div>
        {{ "Are you sure this administrator has been deleted?" | translate }}
      </div>
    </div>
    <div class="button-group">
      <button class="delete-btn" (click)="deleteSubAdmin()">
        <img src="/assets/icons/delete-btn-modal.svg" alt="" />
        {{ "Yes delete!" | translate }}
      </button>
      <button class="cancel-btn" (click)="toggleModal('delete')">
        <img src="/assets/icons/cancel-btn-modal.svg" alt="" />

        {{ "Cancel" | translate }}
      </button>
    </div>
  </div>
</div>

<!-- Add Permissions Modal -->
<div class="modal-add-permissions modal" *ngIf="showAddPermissionsModal">
  <div class="modal-container">
    <div class="modal-header">
      <div class="modal-title">{{ "Add Permissions" | translate }}</div>
    </div>
    <div class="permissions-section">
      <div class="permission-group">
        <div>{{ "Administrator Access" | translate }}</div>
        <span>
          <input
            type="checkbox"
            id="selectAll"
            [checked]="isAllSelected()"
            [indeterminate]="isIndeterminate()"
            (change)="toggleSelectAll($event)"
          />
          <label for="selectAll">{{ "Select all" | translate }}</label>
        </span>
      </div>

      <div class="permission-group" *ngFor="let group of permissionGroups">
        <div>{{ formatGroupName(group.name) | translate }}</div>
        <span *ngFor="let permission of group.permissions">
          <input
            type="checkbox"
            [id]="'perm_' + permission.id"
            [checked]="isPermissionSelected(permission.id)"
            (change)="togglePermission(permission.id)"
          />
          <label [for]="'perm_' + permission.id">{{
            formatPermissionName(permission.name) | translate
          }}</label>
        </span>
      </div>
    </div>
    <div class="button-group">
      <button class="discard-btn" (click)="toggleModal('addPermissions')">
        {{ "Discard" | translate }}
      </button>
      <button class="submit-btn" (click)="toggleModal('addPermissions')">
        {{ "Submit" | translate }}
      </button>
    </div>
  </div>
</div>

<!-- Edit Permissions Modal -->
<div class="modal-add-permissions modal" *ngIf="showEditPermissionsModal">
  <div class="modal-container">
    <div class="modal-header">
      <div class="modal-title">{{ "Edit Permissions" | translate }}</div>
    </div>

    <div class="permissions-section">
      <div class="permission-group">
        <div>{{ "Administrator Access" | translate }}</div>
        <span>
          <input
            type="checkbox"
            id="editSelectAll"
            [checked]="isAllSelected()"
            [indeterminate]="isIndeterminate()"
            (change)="toggleSelectAll($event)"
          />
          <label for="editSelectAll">{{ "Select all" | translate }}</label>
        </span>
      </div>

      <div class="permission-group" *ngFor="let group of permissionGroups">
        <div>{{ formatGroupName(group.name) | translate }}</div>
        <span *ngFor="let permission of group.permissions">
          <input
            type="checkbox"
            [id]="'edit_perm_' + permission.id"
            [checked]="isPermissionSelected(permission.id)"
            (change)="togglePermission(permission.id)"
          />
          <label [for]="'edit_perm_' + permission.id">{{
            formatPermissionName(permission.name) | translate
          }}</label>
        </span>
      </div>
    </div>
    <div class="button-group">
      <button class="discard-btn" (click)="toggleModal('editPermissions')">
        {{ "Discard" | translate }}
      </button>
      <button class="submit-btn" (click)="toggleModal('editPermissions')">
        {{ "Submit" | translate }}
      </button>
    </div>
  </div>
</div>
