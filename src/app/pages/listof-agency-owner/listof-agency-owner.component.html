<div class="table" *ngIf="canViewAgents">
  <!-- Table header -->
  <div class="table-header">
    <div class="table-title">{{ "List of Agency/Owner" | translate }}</div>
    <div class="table-search">
      <img src="/assets/icons/search-icon.svg" alt="" />
      <input
        type="text"
        [placeholder]="'Search by name or phone number' | translate"
        [(ngModel)]="searchTerm"
        (input)="onSearch()"
      />
    </div>
  </div>
  <!-- Table titles -->
  <div class="table-titles">
    <div>
      <span>{{ "S.ON" | translate }}</span>
      <span>
        <img src="/assets/icons/sort-img.svg" alt="" (click)="sortBy('id')" />
      </span>
    </div>
    <div>
      <span>{{ "Name" | translate }}</span>
      <span>
        <img src="/assets/icons/sort-img.svg" alt="" (click)="sortBy('name')" />
      </span>
    </div>
    <div>
      <span>{{ "Mobile Number" | translate }}</span>
      <span>
        <img
          src="/assets/icons/sort-img.svg"
          alt=""
          (click)="sortBy('mobile')"
        />
      </span>
    </div>
    <div>
      <span>{{ "Email" | translate }}</span>
      <span>
        <img
          src="/assets/icons/sort-img.svg"
          alt=""
          (click)="sortBy('email')"
        />
      </span>
    </div>
    <div>
      <span>{{ "agencies-owner" | translate }}</span>
      <span>
        <img
          src="/assets/icons/sort-img.svg"
          alt=""
          (click)="sortBy('angency')"
        />
      </span>
    </div>
    <div>
      <span>{{ "Status" | translate }}</span>
      <span>
        <img
          src="/assets/icons/sort-img.svg"
          alt=""
          (click)="sortBy('status')"
        />
      </span>
    </div>
    <div>
      <span>{{ "Date added" | translate }}</span>
      <span>
        <img
          src="/assets/icons/sort-img.svg"
          alt=""
          (click)="sortBy('DateAdded')"
        />
      </span>
    </div>
    <div>
      <span>{{ "Date Modified" | translate }}</span>
      <span>
        <img
          src="/assets/icons/sort-img.svg"
          alt=""
          (click)="sortBy('DateModified')"
        />
      </span>
    </div>
    <div>
      <span>{{ "Actions" | translate }}</span>
    </div>
  </div>

  <!-- Loading state -->
  <div *ngIf="isLoading" class="loading">
    {{ "Loading..." | translate }}
  </div>

  <!-- No data -->
  <div *ngIf="!isLoading && filteredItems.length === 0" class="table-no-data">
    {{ "No data found" | translate }}
  </div>
  <!-- Table rows -->
  <ng-container *ngIf="!isLoading">
    <div class="table-row" *ngFor="let item of paginatedItems">
      <div>{{ item.id }}</div>
      <div>{{ item.name }}</div>
      <div>{{ item.mobile }}</div>
      <div>{{ item.email }}</div>
      <div>
        <span class="angency">
          {{ item.angency | translate }}
        </span>
      </div>
      <div [class]="getStatusClass(item.status)">
        <span>
          {{ item.status | translate }}
        </span>
      </div>
      <div>{{ item.DateAdded }}</div>
      <div>{{ item.DateModified }}</div>

      <div class="table-actions">
        <span (click)="toggleDropdown(item.id)">
          <img src="/assets/icons/more.svg" alt="more icon" />
        </span>

        <ul *ngIf="activeDropdown === item.id">
          <li (click)="handleAction(item, 'view')">
            {{ "View" | translate }}
          </li>
          <li *ngIf="canEditAgents" (click)="handleAction(item, 'approve')">
            {{ "Approve" | translate }}
          </li>
          <li *ngIf="canEditAgents" (click)="handleAction(item, 'reject')">
            {{ "Reject" | translate }}
          </li>
          <li *ngIf="canDeleteAgents" (click)="handleAction(item, 'delete')">
            {{ "Delete" | translate }}
          </li>
        </ul>
      </div>
    </div>
  </ng-container>
  <!-- Table pagination -->
  <div class="table-pagination" *ngIf="!isLoading && filteredItems.length > 0">
    <div class="table-pagination--show">
      <span> {{ "Show" | translate }} </span>
      <select [(ngModel)]="itemsPerPage" (change)="updatePagination()">
        <option *ngFor="let num of [10, 20, 30]" [value]="num">
          {{ num }}
        </option>
      </select>
      <span> {{ "per page" | translate }} </span>
    </div>

    <div class="table-pagination--pages">
      <div class="table-pagination--pages--count">
        {{ paginationStart + 1 }}-{{ paginationEnd }}
        {{ "of" | translate }}
        {{ filteredItems.length }}
      </div>

      <div class="table-pagination--pages--buttons" dir="ltr">
        <button (click)="prevPage()" [disabled]="currentPage === 1">
          <img src="/assets/icons/arrow-left.svg" alt="prev icon" />
        </button>
        <span
          *ngFor="let page of totalPagesArray"
          (click)="goToPage(page)"
          [class.active]="page === currentPage"
          >{{ page }}</span
        >
        <button (click)="nextPage()" [disabled]="currentPage === totalPages">
          <img src="/assets/icons/arrow-right.svg" alt=" next icon " />
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Permissions loading message -->
<div *ngIf="permissionsLoading" class="loading">
  {{ "Loading..." | translate }}
</div>

<!-- No access message -->
<div *ngIf="!permissionsLoading && !canViewAgents" class="no-access-message">
  {{ "You don't have permission to view agency owners" | translate }}
</div>

<!-- Agent Details Modal -->
<div *ngIf="isModalOpen" class="modal-overlay" (click)="closeModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>{{ "Agent Details" | translate }}</h2>
      <button class="close-button" (click)="closeModal()">
        <img src="/assets/icons/close-modal-icon.svg" alt="Close" />
      </button>
    </div>

    <div class="modal-body" *ngIf="selectedAgent">
      <div class="agent-info-grid">
        <div class="info-item">
          <span class="label">{{ "Name" | translate }}:</span>
          <span class="value">{{ selectedAgent.name }}</span>
        </div>

        <div class="info-item">
          <span class="label">{{ "Email" | translate }}:</span>
          <span class="value">{{ selectedAgent.email }}</span>
        </div>

        <div class="info-item">
          <span class="label">{{ "Phone" | translate }}:</span>
          <span class="value">{{ selectedAgent.phone_number }}</span>
        </div>

        <div class="info-item">
          <span class="label">{{ "Type" | translate }}:</span>
          <span class="value">{{ selectedAgent.type | translate }}</span>
        </div>

        <div class="info-item">
          <span class="label">{{ "Status" | translate }}:</span>
          <span
            class="value"
            [class]="
              getStatusClass(
                selectedAgent.active === 1 ? 'Approved' : 'Rejected'
              )
            "
          >
            {{
              selectedAgent.active === 1 ? "Approved" : ("Rejected" | translate)
            }}
          </span>
        </div>

        <div class="info-item">
          <span class="label">{{ "Created At" | translate }}:</span>
          <span class="value">{{
            formatDatePublic(selectedAgent.created_at)
          }}</span>
        </div>

        <div class="info-item">
          <span class="label">{{ "Updated At" | translate }}:</span>
          <span class="value">{{
            formatDatePublic(selectedAgent.updated_at)
          }}</span>
        </div>

        <!-- Profile Information -->
        <div class="info-section" *ngIf="selectedAgent.agent_profile">
          <h3>{{ "Agency Profile Information" | translate }}</h3>

          <div
            class="info-item"
            *ngIf="selectedAgent.agent_profile.agency_name"
          >
            <span class="label">{{ "Agency Name" | translate }}:</span>
            <span class="value">{{
              selectedAgent.agent_profile.agency_name
            }}</span>
          </div>

          <div
            class="info-item"
            *ngIf="selectedAgent.agent_profile.company_registration_id"
          >
            <span class="label"
              >{{ "Company Registration ID" | translate }}:</span
            >
            <span class="value">{{
              selectedAgent.agent_profile.company_registration_id
            }}</span>
          </div>

          <div
            class="info-item"
            *ngIf="selectedAgent.agent_profile.fal_license_number"
          >
            <span class="label">{{ "FAL License Number" | translate }}:</span>
            <span class="value">{{
              selectedAgent.agent_profile.fal_license_number
            }}</span>
          </div>

          <div
            class="info-item"
            *ngIf="selectedAgent.agent_profile.agency_address_line_1"
          >
            <span class="label">{{ "Address Line 1" | translate }}:</span>
            <span class="value">{{
              selectedAgent.agent_profile.agency_address_line_1
            }}</span>
          </div>

          <div
            class="info-item"
            *ngIf="selectedAgent.agent_profile.agency_address_line_2"
          >
            <span class="label">{{ "Address Line 2" | translate }}:</span>
            <span class="value">{{
              selectedAgent.agent_profile.agency_address_line_2
            }}</span>
          </div>

          <div class="info-item" *ngIf="selectedAgent.agent_profile.city">
            <span class="label">{{ "City" | translate }}:</span>
            <span class="value">{{ selectedAgent.agent_profile.city }}</span>
          </div>

          <div class="info-item" *ngIf="selectedAgent.agent_profile.country">
            <span class="label">{{ "Country" | translate }}:</span>
            <span class="value">{{ selectedAgent.agent_profile.country }}</span>
          </div>

          <div
            class="info-item"
            *ngIf="selectedAgent.agent_profile.postal_code"
          >
            <span class="label">{{ "Postal Code" | translate }}:</span>
            <span class="value">{{
              selectedAgent.agent_profile.postal_code
            }}</span>
          </div>

          <div
            class="info-item"
            *ngIf="selectedAgent.agent_profile.account_number"
          >
            <span class="label">{{ "Account Number" | translate }}:</span>
            <span class="value">{{
              selectedAgent.agent_profile.account_number
            }}</span>
          </div>

          <div class="info-item" *ngIf="selectedAgent.agent_profile.bank_name">
            <span class="label">{{ "Bank Name" | translate }}:</span>
            <span class="value">{{
              selectedAgent.agent_profile.bank_name
            }}</span>
          </div>

          <div
            class="info-item"
            *ngIf="selectedAgent.agent_profile.iban_number"
          >
            <span class="label">{{ "IBAN Number" | translate }}:</span>
            <span class="value">{{
              selectedAgent.agent_profile.iban_number
            }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
