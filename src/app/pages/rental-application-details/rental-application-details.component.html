<div class="application" *ngIf="rentRequest">
  <div class="application-tabs">
    <div
      [class.active]="activeTab === 'overview'"
      (click)="setActiveTab('overview')"
      class="tab-item"
    >
      <span *ngIf="activeTab === 'overview'">
        <img src="/assets/icons/overview-active.svg" alt="overview icon" />
      </span>
      <span *ngIf="activeTab !== 'overview'">
        <img src="/assets/icons/overview-inactive.svg" alt="overview icon" />
      </span>
      {{ "Overview" | translate }}
    </div>
    <div
      [class.active]="activeTab === 'assessment'"
      (click)="setActiveTab('assessment')"
      class="tab-item"
      *ngIf="userRoleService.getCurrentRole() === 'admin'"
    >
      <span *ngIf="activeTab === 'assessment'">
        <img src="/assets/icons/assessment-active.svg" alt="assessment icon" />
      </span>
      <span *ngIf="activeTab !== 'assessment'">
        <img
          src="/assets/icons/assessment-inactive.svg"
          alt="assessment icon"
        />
      </span>
      {{ "Assessment" | translate }}
    </div>
    <div
      [class.active]="activeTab === 'schedule'"
      (click)="setActiveTab('schedule')"
      class="tab-item"
      *ngIf="userRoleService.getCurrentRole() === 'admin'"
    >
      <span *ngIf="activeTab === 'schedule'">
        <img src="/assets/icons/schedule-active.svg" alt="schedule icon" />
      </span>
      <span *ngIf="activeTab !== 'schedule'">
        <img src="/assets/icons/schedule-inactive.svg" alt="schedule icon" />
      </span>
      {{ "Schedule" | translate }}
    </div>
  </div>
  <!-- overview -->
  <div
    class="application-overview"
    *ngIf="
      activeTab === 'overview' || userRoleService.getCurrentRole() === 'agent'
    "
  >
    <div class="application-overview-card">
      <div class="application-overview-card--title">
        <img src="/assets/icons/tenant-icon.svg" alt="" />
        <span> {{ "Tenant Information" | translate }} </span>
      </div>
      <div class="application-overview-card--content type1">
        <div class="application-overview-card--content--img">
          <img src="/assets/images/user-dummy.png" alt="" />
          <span>{{ rentRequest?.name }}</span>
        </div>
        <div class="application-overview-card--content--group">
          <div class="application-overview-card--content--item">
            <span> {{ "Email" | translate }} </span>
            <span>{{ rentRequest?.email || "-" }}</span>
          </div>
          <div class="application-overview-card--content--item">
            <span> {{ "Contact" | translate }} </span>
            <span dir="ltr">{{ rentRequest?.phone || "-" }}</span>
          </div>
        </div>

        <div class="application-overview-card--content--item">
          <span> {{ "Location" | translate }} </span>
          <span>{{ rentRequest?.property?.city || "-" }}</span>
        </div>
      </div>
    </div>
    <div class="application-overview-card">
      <div class="application-overview-card--title">
        <img src="/assets/icons/property-owner-icon.svg" alt="" />
        <span> {{ "Property Owner" | translate }} </span>
      </div>
      <div class="application-overview-card--content type1">
        <div class="application-overview-card--content--img">
          <img src="/assets/images/user-dummy.png" alt="" />
          <span>-</span>
        </div>
        <div class="application-overview-card--content--group">
          <div class="application-overview-card--content--item">
            <span> {{ "Email" | translate }} </span>
            <span>-</span>
          </div>
          <div class="application-overview-card--content--item">
            <span> {{ "Contact" | translate }} </span>
            <span>-</span>
          </div>
        </div>

        <div class="application-overview-card--content--item">
          <span> {{ "Location" | translate }} </span>
          <span>-</span>
        </div>
      </div>
    </div>
    <div class="application-overview-card">
      <div class="application-overview-card--title">
        <img src="/assets/icons/property-details-icon.svg" alt="" />
        <span> {{ "Property Details" | translate }} </span>
      </div>
      <div class="application-overview-card--content type2">
        <div class="application-overview-card--content--imgpreview">
          <img src="/assets/images/property-details-img.png" alt="" class="" />
        </div>

        <div class="application-overview-card--content--itemsgroup">
          <div class="application-overview-card--content--item">
            <span> {{ "Property Type" | translate }} </span>
            <span>{{ propertyTypeLabel }}</span>
          </div>
          <div class="application-overview-card--content--item">
            <span> {{ "Address" | translate }} </span>
            <span>
              {{ rentRequest?.property?.building_number || "-" }},
              {{ rentRequest?.property?.district || "-" }},
              {{ rentRequest?.property?.city || "-" }},
              {{ rentRequest?.property?.region || "-" }}
              {{
                rentRequest?.property?.postal_code
                  ? "-" + rentRequest?.property?.postal_code
                  : ""
              }}
            </span>
          </div>
          <div class="application-overview-card--content--buttons">
            <div class="application-overview-card--content--button">
              <span> {{ "Annual Rent" | translate }} </span>
              <span
                >{{ rentRequest?.property?.annual_rent | number }}
                {{ "SAR" | translate }}</span
              >
            </div>
            <div class="application-overview-card--content--button">
              <span> {{ "Security Deposit" | translate }} </span>
              <span
                >{{ rentRequest?.property?.deposit_amount | number }}
                {{ "SAR" | translate }}</span
              >
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- assessment -->
  <div
    class="application-assessment"
    *ngIf="
      activeTab === 'assessment' && userRoleService.getCurrentRole() === 'admin'
    "
  >
    <div class="application-assessment-title">
      <img src="/assets/icons/financial-title-icon.svg" alt="" />
      <span> {{ "Financial Assessment" | translate }} </span>
    </div>
    <div class="application-assessment-cards">
      <!-- card 1 -->
      <div class="application-assessment-card">
        <div class="application-assessment-card--title">
          <img src="/assets/icons/tenant-icon.svg" alt="" />
          <span> {{ "Personal Details" | translate }} </span>
        </div>
        <div class="application-assessment-card--content">
          <div class="application-assessment-card--content--item">
            <span> {{ "Full Name" | translate }} </span>
            {{ rentRequest?.name || "-" }}
          </div>
          <div class="application-assessment-card--content--item">
            <span> {{ "Mobile Number" | translate }} </span>
            <span dir="ltr">{{ rentRequest?.phone || "-" }}</span>
          </div>
          <div class="application-assessment-card--content--item">
            <span> {{ "Email" | translate }} </span>
            {{ rentRequest?.email || "-" }}
          </div>
          <div class="application-assessment-card--content--item">
            <span> {{ "Location" | translate }} </span>
            {{ getCityNameById(rentRequest?.city_id) }}
          </div>
          <div class="application-assessment-card--content--item">
            <span> {{ "Date of birth" | translate }} </span>
            {{
              rentRequest?.date_of_birth
                ? (rentRequest?.date_of_birth | date : "yyyy-MM-dd")
                : "-"
            }}
          </div>
          <div class="application-assessment-card--content--item">
            <span> {{ "Nationality" | translate }} </span>
            {{ rentRequest?.nationality || "-" }}
          </div>
          <div class="application-assessment-card--content--item">
            <span> {{ "No. of members" | translate }} </span>
            {{ rentRequest?.number_of_family_members || "-" }}
          </div>
          <div class="application-assessment-card--content--item">
            <span> {{ "National ID Number" | translate }} </span>
            {{ rentRequest?.national_id || "-" }}
          </div>
        </div>
      </div>
      <!-- card 2 -->
      <div class="application-assessment-card">
        <div class="application-assessment-card--title">
          <img src="/assets/icons/employment-icon.svg" alt="" />
          <span> {{ "Employment Details" | translate }} </span>
        </div>
        <div class="application-assessment-card--content">
          <div class="application-assessment-card--content--checkgroup">
            <div class="application-assessment-card--content--checkitem">
              <span [class.active]="isEmployed"></span>
              <span>{{ "Employed" | translate }}</span>
            </div>
            <div class="application-assessment-card--content--checkitem">
              <span [class.active]="!isEmployed"></span>
              <span>{{ "Self-Employed" | translate }}</span>
            </div>
          </div>
          <div class="application-assessment-card--content--item">
            <span> {{ "Work Start Date" | translate }} </span>
            {{
              rentRequest?.job_start_date
                ? (rentRequest?.job_start_date | date : "yyyy-MM-dd")
                : "-"
            }}
          </div>
          <div class="application-assessment-card--content--item">
            <span> {{ "Name of Working place" | translate }} </span>
            {{ rentRequest?.working_place || "-" }}
          </div>
          <div class="application-assessment-card--content--item">
            <span> {{ "Job Sector" | translate }} </span>
            {{ rentRequest?.sector || "-" }}
          </div>

          <div class="application-assessment-certificate">
            <ng-container
              *ngIf="rentRequest?.proof_of_income_document; else noIncomeDoc"
            >
              <a
                [href]="'/' + rentRequest?.proof_of_income_document"
                target="_blank"
              >
                {{ "Income Certificate" | translate }}
              </a>
            </ng-container>
            <ng-template #noIncomeDoc>
              {{ "NO Income Certificate" | translate }}
            </ng-template>
          </div>
          <div class="application-assessment-card--content--item">
            <span> {{ "Sub Sector" | translate }} </span>
            {{ rentRequest?.subsector || "-" }}
          </div>
          <div class="application-assessment-card--content--check">
            <p>{{ "Do you have any existing debts ?" | translate }}</p>
            <div class="application-assessment-card--content--checkgroup">
              <div class="application-assessment-card--content--checkitem">
                <span [class.active]="rentRequest?.has_debts === true"></span>
                <span>{{ "Yes" | translate }}</span>
              </div>
              <div class="application-assessment-card--content--checkitem">
                <span [class.active]="rentRequest?.has_debts === false"></span>
                <span>{{ "No" | translate }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- card 3 -->
      <div class="application-assessment-card">
        <div class="application-assessment-card--title">
          <img src="/assets/icons/employment-icon.svg" alt="" />
          <span> {{ "Employment Details" | translate }} </span>
        </div>
        <div class="application-assessment-card--content">
          <!-- Credit Score Document -->
          <div class="application-assessment-csd">
            <ng-container
              *ngIf="rentRequest?.credit_score_document; else noCreditDoc"
            >
              <a
                [href]="'/' + rentRequest?.credit_score_document"
                target="_blank"
              >
                {{ "Credit Score Document" | translate }}
              </a>
            </ng-container>
            <ng-template #noCreditDoc>
              {{ "Credit Score Document" | translate }} -
              {{ "Not Provided" | translate }}
            </ng-template>
          </div>
          <div class="application-assessment-card--content--item">
            <span> {{ "Annual Rent" | translate }} </span>
            {{ rentRequest?.annual_rent || "-" }}
            {{ "SAR" | translate }}
          </div>
          <div class="application-assessment-card--content--item">
            <span> {{ "Monthl Income" | translate }} </span>
            {{ rentRequest?.monthly_income | number }} {{ "SAR" | translate }}
          </div>
          <div class="application-assessment-card--content--item">
            <span> {{ "Employer Name" | translate }} </span>
            {{ rentRequest?.employer_name || "-" }}
          </div>
          <div class="application-assessment-card--content--item">
            <span> {{ "Expected Monthly Expenses" | translate }} </span>
            {{ rentRequest?.expected_monthly_cost | number }}
            {{ "SAR" | translate }}
          </div>
          <div class="application-assessment-card--content--item">
            <span>{{ "No of Installments" | translate }} </span>
            {{ rentRequest?.number_of_installments || "-" }}
          </div>
          <div class="application-assessment-emi">
            {{ "Monthly EMI" | translate }}
            {{ rentRequest?.expected_monthly_cost || 0 | number }}
            {{ "SAR" | translate }}
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- schedule -->
  <div
    class="application-schedule"
    *ngIf="
      activeTab === 'schedule' && userRoleService.getCurrentRole() === 'admin'
    "
  >
    <div class="application-schedule-title">
      <img src="/assets/icons/payment-icon.svg" alt="" />
      <span> {{ "Payment Schedule" | translate }} </span>
    </div>

    <div class="application-schedule-table table">
      <div class="table-titles">
        <div>
          <span>{{ "Due Date" | translate }}</span>
          <span (click)="sortSchedule('dueDate')">
            <img src="/assets/icons/sort-img.svg" alt="" />
          </span>
        </div>
        <div>
          <span>{{ "Amount" | translate }}</span>
          <span (click)="sortSchedule('amount')">
            <img src="/assets/icons/sort-img.svg" alt="" />
          </span>
        </div>
        <div>
          <span>{{ "Balance" | translate }}</span>
          <span (click)="sortSchedule('balance')">
            <img src="/assets/icons/sort-img.svg" alt="" />
          </span>
        </div>
        <div>
          <span>{{ "Status" | translate }}</span>
          <span (click)="sortSchedule('status')">
            <img src="/assets/icons/sort-img.svg" alt="" />
          </span>
        </div>
      </div>
      <div
        class="table-row"
        *ngFor="let item of application?.schedule; let i = index"
      >
        <div>{{ item.dueDate }}</div>
        <div>{{ item.amount | number : "1.2-2" }} {{ "SAR" | translate }}</div>
        <div>{{ item.balance | number : "1.2-2" }} {{ "SAR" | translate }}</div>
        <div [class]="'status-' + item.status">
          <span>{{ item.status | titlecase }}</span>
        </div>
      </div>

      <div class="table-settings">
        <div (click)="openReviseModal()" class="table-settings-revise">
          <img src="/assets/icons/revise.svg" alt="" />
          {{ "Revise" | translate }}
        </div>
        <div (click)="rejectSchedule()" class="table-settings-reject">
          <img src="/assets/icons/reject-icon.svg" alt="" />

          {{ "Reject" | translate }}
        </div>
        <div (click)="approveSchedule()" class="table-settings-approve">
          <img src="/assets/icons/confirm-icon.svg" alt="" />

          {{ "Approve" | translate }}
        </div>
      </div>
    </div>
  </div>

  <!-- Revise Modal -->
  <div class="modal" *ngIf="showReviseModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>{{ "Revise Schedule" | translate }}</h2>
        <span class="close" (click)="closeReviseModal()">&times;</span>
      </div>
      <div class="modal-body">
        <div
          class="modal-row"
          *ngFor="let item of editedSchedule; let i = index"
        >
          <div class="schedule-item">
            <div class="schedule-item-header">
              <h3>{{ "Payment" | translate }} {{ i + 1 }}</h3>
            </div>
            <div class="schedule-item-content">
              <div class="form-group">
                <label>{{ "Due Date" | translate }}</label>
                <input
                  type="text"
                  [(ngModel)]="item.dueDate"
                  (ngModelChange)="updateScheduleItem(i, 'dueDate', $event)"
                />
              </div>
              <div class="form-group">
                <label>{{ "Amount" | translate }}</label>
                <input
                  type="number"
                  [(ngModel)]="item.amount"
                  (ngModelChange)="updateScheduleItem(i, 'amount', $event)"
                />
              </div>
              <div class="form-group">
                <label>{{ "Balance" | translate }}</label>
                <input
                  type="number"
                  [(ngModel)]="item.balance"
                  (ngModelChange)="updateScheduleItem(i, 'balance', $event)"
                />
              </div>
              <div class="form-group">
                <label>{{ "Status" | translate }}</label>
                <select
                  [(ngModel)]="item.status"
                  (ngModelChange)="updateScheduleItem(i, 'status', $event)"
                >
                  <option *ngFor="let status of statusOptions" [value]="status">
                    {{ status | titlecase }}
                  </option>
                </select>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="cancel-btn" (click)="closeReviseModal()">
          {{ "Cancel" | translate }}
        </button>
        <button class="submit-btn" (click)="submitRevise()">
          {{ "Submit" | translate }}
        </button>
      </div>
    </div>
  </div>
</div>
